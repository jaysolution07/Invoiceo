<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Assistant Gestion</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f5f7fb}
.header{background:#2563eb;color:white;padding:20px;font-size:20px}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:white;padding:20px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08);margin-bottom:20px}
button{background:#2563eb;color:white;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;margin:5px}
input{padding:8px;margin:4px 0;width:100%}
.line{display:flex;gap:10px;align-items:center}
.deleteBtn{background:#ef4444}
.clearBtn{background:#f59e0b}
.saveBtn{background:#16a34a}
.totals{background:#f1f5f9;padding:15px;border-radius:8px;margin-top:10px}
.hidden{display:none}
.suggestion{padding:6px;cursor:pointer}
.suggestion:hover{background:#f1f5f9}
</style>
</head>

<body>

<div class="header">ğŸ“Š Assistant gestion</div>

<div class="container">

<!-- HOME -->
<div id="homePage" class="card">
<h3>Menu principal</h3>
<button onclick="showPage('devisPage')">ğŸ“„ CrÃ©er devis</button>
<button onclick="showPage('clientPage')">ğŸ‘¥ Clients</button>
<button onclick="showPage('articlePage')">ğŸ“¦ Articles</button>
</div>

<!-- CLIENT -->
<div id="clientPage" class="card hidden">
<h3>Ajouter un client</h3>
<input id="c_nom" placeholder="Nom">
<input id="c_adresse" placeholder="Adresse">
<input id="c_mail" placeholder="Email">
<input id="c_tel" placeholder="TÃ©lÃ©phone">
<button class="saveBtn" onclick="saveClient()">ğŸ’¾ Enregistrer</button>

<h3>Liste des clients</h3>
<div id="clientsTable"></div>

<button onclick="showPage('homePage')">â¬…ï¸ Retour</button>
</div>

<!-- ARTICLES -->
<div id="articlePage" class="card hidden">
<h3>Ajouter un article</h3>
<input id="a_nom" placeholder="Nom article">
<button class="saveBtn" onclick="saveArticle()">ğŸ’¾ Ajouter</button>

<h3>Liste des articles</h3>
<div id="articlesTable"></div>

<button onclick="showPage('homePage')">â¬…ï¸ Retour</button>
</div>

<!-- DEVIS (INCHANGÃ‰) -->
<div id="devisPage" class="card hidden">

<button onclick="showPage('homePage')">â¬…ï¸ Retour menu</button>
<h3>CrÃ©er un devis</h3>

<div class="card">
<button onclick="startVocal()">ğŸ¤ Micro</button>
<button onclick="stopVocal()">ğŸ›‘ Stop</button>
<p id="status"></p>
</div>

<label>Client</label>
<input id="clientInput" placeholder="Tapez pour rechercher...">
<div id="clientSuggestions"></div>

<h3>Lignes</h3>
<div id="lines"></div>

<button onclick="addLine()">â• Ajouter ligne</button>
<button class="clearBtn" onclick="clearAll()">ğŸ§¹ Tout effacer</button>

<label>Remise (%)</label>
<input id="remise" oninput="calculate()">

<label>TVA (%)</label>
<input id="tva" oninput="calculate()">

<div class="totals">
<div>Total HT : <b id="totalHT">0 â‚¬</b></div>
<div>Montant remise : <b id="montantRemise">0 â‚¬</b></div>
<div>Total HT aprÃ¨s remise : <b id="totalApresRemise">0 â‚¬</b></div>
<div>Montant TVA : <b id="montantTVA">0 â‚¬</b></div>
<div>Total TTC : <b id="totalTTC">0 â‚¬</b></div>
</div>

<button class="saveBtn" onclick="saveDevis()">ğŸ’¾ Enregistrer devis</button>

</div>
</div>

<script>
const WEBAPP_URL="https://script.google.com/macros/s/AKfycbyy763BTRzWHbYDzuDJev1j8G4taqviqYqAcj8Q15vYR7USmiMGhpqAhq_fuv97P3qq/exec";

// NAVIGATION
function showPage(id){
  homePage.classList.add("hidden");
  clientPage.classList.add("hidden");
  devisPage.classList.add("hidden");
  articlePage.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

//////////////////// CLIENTS ////////////////////
let clientsList=[];

function loadClients(){
  fetch(WEBAPP_URL+"?clientsTable=1")
  .then(r=>r.json())
  .then(data=>{
    clientsList=data;
    renderClients();
  });
}
loadClients();

function renderClients(){
  clientsTable.innerHTML="";
  clientsList.forEach((c,i)=>{
    clientsTable.innerHTML += `
    <div class="line">
      <input value="${c.nom}" onchange="updateClient(${i},'nom',this.value)">
      <input value="${c.adresse}" onchange="updateClient(${i},'adresse',this.value)">
      <input value="${c.mail}" onchange="updateClient(${i},'mail',this.value)">
      <input value="${c.tel}" onchange="updateClient(${i},'tel',this.value)">
      <button class="deleteBtn" onclick="deleteClient(${i})">âœ–</button>
    </div>`;
  });
}

function updateClient(i,field,val){
  fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify({type:"updateClientFull",index:i,field,value:val}),mode:"no-cors"});
}

function deleteClient(i){
  fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify({type:"deleteClient",index:i}),mode:"no-cors"});
  clientsList.splice(i,1);
  renderClients();
}

function saveClient(){
  fetch(WEBAPP_URL,{
    method:"POST",
    body:JSON.stringify({type:"client",nom:c_nom.value,adresse:c_adresse.value,mail:c_mail.value,tel:c_tel.value}),
    mode:"no-cors"
  });
  loadClients();
}

//////////////////// ARTICLES ////////////////////
let articles=[];

function loadArticles(){
  fetch(WEBAPP_URL+"?articlesTable=1")
  .then(r=>r.json())
  .then(data=>{
    articles=data;
    renderArticles();
  });
}
loadArticles();

function renderArticles(){
  articlesTable.innerHTML="";
  articles.forEach((a,i)=>{
    articlesTable.innerHTML += `
    <div class="line">
      <input value="${a.nom}" onchange="updateArticle(${i},this.value)">
      <button class="deleteBtn" onclick="deleteArticle(${i})">âœ–</button>
    </div>`;
  });
}

function saveArticle(){
  fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify({type:"article",nom:a_nom.value}),mode:"no-cors"});
  loadArticles();
}

function updateArticle(i,val){
  fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify({type:"updateArticle",index:i,nom:val}),mode:"no-cors"});
}

function deleteArticle(i){
  fetch(WEBAPP_URL,{method:"POST",body:JSON.stringify({type:"deleteArticle",index:i}),mode:"no-cors"});
  loadArticles();
}

//////////////////// DEVIS (INCHANGÃ‰) ////////////////////
let devis={lignes:[]};

function render(){
  lines.innerHTML="";
  devis.lignes.forEach((l,i)=>{
    lines.innerHTML+=`
    <div class="line">
      <input value="${l.designation}" oninput="devis.lignes[${i}].designation=this.value">
      <input type="number" value="${l.quantite}" oninput="devis.lignes[${i}].quantite=this.value;calculate()">
      <input type="number" value="${l.prix}" oninput="devis.lignes[${i}].prix=this.value;calculate()">
      <button class="deleteBtn" onclick="deleteLine(${i})">âœ–</button>
    </div>`;
  });
  calculate();
}

function addLine(){devis.lignes.push({designation:"",quantite:1,prix:0});render();}
function deleteLine(i){devis.lignes.splice(i,1);render();}
function clearAll(){devis={lignes:[]};render();}

function calculate(){
  let ht=0;
  devis.lignes.forEach(l=>ht+=Number(l.quantite||0)*Number(l.prix||0));
  let r=Number(remise.value)||0;
  let remVal=ht*(r/100);
  let htApres=ht-remVal;
  let t=Number(tva.value)||0;
  let tvaVal=htApres*(t/100);
  let ttc=htApres+tvaVal;
  totalHT.textContent=ht.toFixed(2)+" â‚¬";
  montantRemise.textContent=remVal.toFixed(2)+" â‚¬";
  totalApresRemise.textContent=htApres.toFixed(2)+" â‚¬";
  montantTVA.textContent=tvaVal.toFixed(2)+" â‚¬";
  totalTTC.textContent=ttc.toFixed(2)+" â‚¬";
}

function saveDevis(){
  fetch(WEBAPP_URL,{
    method:"POST",
    body:JSON.stringify({type:"devis",client:clientInput.value,lignes:devis.lignes,remise:remise.value,tva:tva.value}),
    mode:"no-cors"
  });
  alert("Devis enregistrÃ©");
}
</script>

</body>
</html>
```
